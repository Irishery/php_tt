# URL Shortener

Простой сервис сокращения URL на PHP с MariaDB и Docker.

---

## Описание

* Генерация коротких ссылок из длинных URL
* Хранение в MariaDB с использованием PDO и миграций
* Настройки через `.env` файл
* Веб-интерфейс с аналитикой переходов и отображением карт

---

## Требования

* Docker
* Docker Compose
* PHP 8+ (в контейнере)

---

## Быстрый старт

1. Клонируйте репозиторий и перейдите в папку проекта:

   ```bash
   git clone https://github.com/Irishery/php_tt.git
   cd php_tt
   ```

2. Скопируйте шаблон `.env-template` в `.env` и заполните своими параметрами:

   ```bash
   cp .env-template .env
   # отредактируйте .env под свои настройки (БД, SMTP, BASE_URL)
   ```

3. Запустите установочный скрипт:

   ```bash
   ./up.sh [--prod] [--reset]
   ```

   Опции:
   `--prod` — запуск в продакшн режиме (использует docker-compose.prod.yml)
   `--reset` — удаление volume с базой данных перед запуском

   Скрипт выполнит:

   * Остановит контейнеры (с опциональным удалением данных)
   * Пересоберёт образы без кеша
   * Запустит контейнеры в фоне
   * Подождёт готовности MariaDB
   * Проверит подключение к базе из PHP-контейнера
   * Применит миграции
   * Выведет ссылку на приложение

---

## Структура проекта

* `/app` — PHP-код (контроллеры, модели, ядро, миграции)
* `/app/migrations` — SQL миграции для БД
* `/config` — конфигурация приложения с загрузкой из `.env`
* `/docker` — Dockerfile для PHP
* `docker-compose.dev.yml` — конфигурация для разработки
* `docker-compose.prod.yml` — конфигурация для продакшна
* `up.sh` — скрипт для запуска, остановки, миграций и проверки сервиса
* `.env-template` — шаблон файла с настройками окружения

---

## Основные маршруты

| Метод | URL          | Описание                            |
| ----- | ------------ | ----------------------------------- |
| GET   | `/`          | Форма ввода URL для сокращения      |
| POST  | `/shorten`   | Создание короткой ссылки            |
| GET   | `/r/{code}`  | Перенаправление на оригинальный URL |
| GET   | `/login`     | Страница входа                      |
| POST  | `/login`     | Обработка входа                     |
| GET   | `/register`  | Страница регистрации                |
| POST  | `/register`  | Регистрация пользователя            |
| GET   | `/verify`    | Подтверждение email по токену       |
| GET   | `/analytics` | Просмотр статистики и аналитики     |
| GET   | `/logout`    | Выход из системы                    |

---

## Работа с базой данных

* Используются миграции для создания и обновления таблиц
* Подключение к MariaDB по PDO с параметрами из `.env`

---

## Примечания

* Для отправки email используется SMTP, параметры которого задаются в `.env`
* Вся чувствительная информация (пароли, ключи) хранится в `.env` и не должна попадать в репозиторий
* Контейнеры PHP и MariaDB связаны по внутреннему имени `db` для подключения к БД

---

## Схема базы данных

https://drive.google.com/file/d/1F2IGthCdVf5Yiol2nMqpCiwZ15kU2esm/view?usp=sharing
